<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
  <dict>
    <key>patterns</key>
    <array>
      <dict>
        <key>include</key>
        <string>#comment-markdown-cell-inject-python</string>
      </dict>
    </array>
    <key>repository</key>
    <dict>
      <key>comment-markdown-cell-inject-python</key>
      <dict>
        <key>name</key>
        <string>text.html.markdown.comment.python</string>
        <key>begin</key>
        <string>(?&lt;=(?:^|\G)(?:#\s*%%\s*\[markdown\]|#\s*&lt;markdowncell&gt;)\s*)$</string>
        <key>end</key>
        <string>(^|\G)(?=[^#\s]|#\s*%%|\s+\S)</string>

        <!-- <key>while</key>
        <string>(^# |\G# )(?=\s*%%)|(?:^|\G)\s*</string>
        <key>whileCaptures</key>
        <dict>
          <key>0</key>
          <dict>
            <key>name</key>
            <string>comment.punctuation.definition.markdown.python</string>
          </dict>
        </dict> -->

        <key>patterns</key>
        <array>
          <dict>
            <key>include</key>
            <string>#block</string>
          </dict>
          <dict>
            <key>name</key>
            <string>comment.punctuation.definition.markdown.python</string>
            <key>match</key>
            <string>(^# |\G# )</string>
          </dict>
        </array>
      </dict>




      <key>block</key>
      <dict>
        <key>patterns</key>
        <array>
          <dict>
            <key>include</key>
            <string>#separator</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#heading</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#blockquote</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#lists</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#fenced_code_block</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#raw_block</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#link-def</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#html</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#paragraph</string>
          </dict>
        </array>
      </dict>
      <key>blockquote</key>
      <dict>
        <key>begin</key>
        <string>(^# |\G# )[ ]{0,3}(&gt;) ?</string>
                    <key>beginCaptures</key>
                    <dict>
                      <key>1</key>
                      <dict>
                        <key>name</key>
                        <string>comment.punctuation.definition.markdown.python</string>
                      </dict>
                    </dict>
        <key>captures</key>
        <dict>
          <key>2</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.quote.begin.markdown.python</string>
          </dict>
        </dict>
        <key>name</key>
        <string>markup.quote.markdown.python</string>
        <key>patterns</key>
        <array>
          <dict>
            <key>include</key>
            <string>#block</string>
          </dict>
        </array>
        <key>while</key>
        <string>(^# |\G# )\s*(&gt;) ?</string>
                    <key>whileCaptures</key>
                    <dict>
                      <key>1</key>
                      <dict>
                        <key>name</key>
                        <string>comment.punctuation.definition.markdown.python</string>
                      </dict>
                    </dict>
      </dict>

      <key>fenced_code_block</key>
      <dict>
        <key>patterns</key>
        <array>
          <dict>
            <key>include</key>
            <string>#fenced_code_block_unknown</string>
          </dict>
        </array>
      </dict>
      <key>fenced_code_block_unknown</key>
      <dict>        <key>while</key>
        <string>(^# |\G# )(?!(\2|\s{0,3})(\3)\s*$)</string>
                    <key>whileCaptures</key>
                    <dict>
                      <key>1</key>
                      <dict>
                        <key>name</key>
                        <string>comment.punctuation.definition.markdown.python</string>
                      </dict>
                    </dict>

        <key>begin</key>
        <string>(^# |\G# )(\s*)(`{3,}|~{3,})\s*(?=([^`~]*)?$)</string>
        <key>beginCaptures</key>
        <dict>
          <key>3</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.markdown.python</string>
          </dict>
          <key>4</key>
          <dict>
            <key>name</key>
            <string>fenced_code.block.language</string>
          </dict>
        </dict>
        <key>end</key>
        <string>(^# |\G# )(\2|\s{0,3})(\3)\s*$</string>
        <key>endCaptures</key>
        <dict>
          <key>3</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.markdown.python</string>
          </dict>
        </dict>
        <key>name</key>
        <string>markup.fenced_code.block.markdown.python</string>
      </dict>
      <key>heading</key>
      <dict>
        <key>match</key>
        <string>(^# |\G# )[ ]{0,3}(#{1,6}\s+(.*?)(\s+#{1,6})?\s*)$</string>
        <key>captures</key>
        <dict>
          <key>1</key>
          <dict>
            <key>name</key>
            <string>comment.punctuation.definition.markdown.python</string>
          </dict>
          <key>2</key>
          <dict>
            <key>patterns</key>
            <array>
              <dict>
                <key>match</key>
                <string>(#{6})\s+(.*?)(?:\s+(#+))?\s*$</string>
                <key>name</key>
                <string>heading.6.markdown.python</string>
                <key>captures</key>
                <dict>
                  <key>1</key>
                  <dict>
                    <key>name</key>
                    <string>punctuation.definition.heading.markdown.python</string>
                  </dict>
                  <key>2</key>
                  <dict>
                    <key>name</key>
                    <string>entity.name.section.markdown.python</string>
                  </dict>
                  <key>3</key>
                  <dict>
                    <key>name</key>
                    <string>punctuation.definition.heading.markdown.python</string>
                  </dict>
                </dict>
              </dict>
              <dict>
                <key>match</key>
                <string>(#{5})\s+(.*?)(?:\s+(#+))?\s*$</string>
                <key>name</key>
                <string>heading.5.markdown.python</string>
                <key>captures</key>
                <dict>
                  <key>1</key>
                  <dict>
                    <key>name</key>
                    <string>punctuation.definition.heading.markdown.python</string>
                  </dict>
                  <key>2</key>
                  <dict>
                    <key>name</key>
                    <string>entity.name.section.markdown.python</string>
                  </dict>
                  <key>3</key>
                  <dict>
                    <key>name</key>
                    <string>punctuation.definition.heading.markdown.python</string>
                  </dict>
                </dict>
              </dict>
              <dict>
                <key>match</key>
                <string>(#{4})\s+(.*?)(?:\s+(#+))?\s*$</string>
                <key>name</key>
                <string>heading.4.markdown.python</string>
                <key>captures</key>
                <dict>
                  <key>1</key>
                  <dict>
                    <key>name</key>
                    <string>punctuation.definition.heading.markdown.python</string>
                  </dict>
                  <key>2</key>
                  <dict>
                    <key>name</key>
                    <string>entity.name.section.markdown.python</string>
                  </dict>
                  <key>3</key>
                  <dict>
                    <key>name</key>
                    <string>punctuation.definition.heading.markdown.python</string>
                  </dict>
                </dict>
              </dict>
              <dict>
                <key>match</key>
                <string>(#{3})\s+(.*?)(?:\s+(#+))?\s*$</string>
                <key>name</key>
                <string>heading.3.markdown.python</string>
                <key>captures</key>
                <dict>
                  <key>1</key>
                  <dict>
                    <key>name</key>
                    <string>punctuation.definition.heading.markdown.python</string>
                  </dict>
                  <key>2</key>
                  <dict>
                    <key>name</key>
                    <string>entity.name.section.markdown.python</string>
                  </dict>
                  <key>3</key>
                  <dict>
                    <key>name</key>
                    <string>punctuation.definition.heading.markdown.python</string>
                  </dict>
                </dict>
              </dict>
              <dict>
                <key>match</key>
                <string>(#{2})\s+(.*?)(?:\s+(#+))?\s*$</string>
                <key>name</key>
                <string>heading.2.markdown.python</string>
                <key>captures</key>
                <dict>
                  <key>1</key>
                  <dict>
                    <key>name</key>
                    <string>punctuation.definition.heading.markdown.python</string>
                  </dict>
                  <key>2</key>
                  <dict>
                    <key>name</key>
                    <string>entity.name.section.markdown.python</string>
                  </dict>
                  <key>3</key>
                  <dict>
                    <key>name</key>
                    <string>punctuation.definition.heading.markdown.python</string>
                  </dict>
                </dict>
              </dict>
              <dict>
                <key>match</key>
                <string>(#{1})\s+(.*?)(?:\s+(#+))?\s*$</string>
                <key>name</key>
                <string>heading.1.markdown.python</string>
                <key>captures</key>
                <dict>
                  <key>1</key>
                  <dict>
                    <key>name</key>
                    <string>punctuation.definition.heading.markdown.python</string>
                  </dict>
                  <key>2</key>
                  <dict>
                    <key>name</key>
                    <string>entity.name.section.markdown.python</string>
                  </dict>
                  <key>3</key>
                  <dict>
                    <key>name</key>
                    <string>punctuation.definition.heading.markdown.python</string>
                  </dict>
                </dict>
              </dict>
            </array>
          </dict>
        </dict>
        <key>name</key>
        <string>markup.heading.markdown.python</string>
        <key>patterns</key>
        <array>
          <dict>
            <key>include</key>
            <string>#inline</string>
          </dict>
        </array>
      </dict>
      <key>heading-setext</key>
      <dict>
        <key>patterns</key>
        <array>
          <dict>
            <key>match</key>
            <string>^# (={3,})(?=[ \t]*$(?:\\n# )?)</string>
            <key>name</key>
            <string>markup.heading.setext.1.markdown.python</string>
          </dict>
          <dict>
            <key>match</key>
            <string>^# (-{3,})(?=[ \t]*$(?:\\n# )?)</string>
            <key>name</key>
            <string>markup.heading.setext.2.markdown.python</string>
          </dict>
        </array>
      </dict>
      <key>html</key>
      <dict>
        <key>patterns</key>
        <array>
          <dict>
            <key>begin</key>
            <string>(^# |\G# )\s*(&lt;!--)</string>
                    <key>beginCaptures</key>
                    <dict>
                      <key>1</key>
                      <dict>
                        <key>name</key>
                        <string>comment.punctuation.definition.markdown.python</string>
                      </dict>
                    </dict>
            <key>captures</key>
            <dict>
              <key>1</key>
              <dict>
                <key>name</key>
                <string>punctuation.definition.comment.html</string>
              </dict>
              <key>2</key>
              <dict>
                <key>name</key>
                <string>punctuation.definition.comment.html</string>
              </dict>
            </dict>
            <key>end</key>
            <string>(--&gt;)</string>
            <key>name</key>
            <string>comment.block.html</string>
          </dict>
          <dict>
            <key>begin</key>
            <string>(?i)(^# |\G# )\s*(?=&lt;(script|style|pre)(\s|$|&gt;)(?!.*?&lt;/(script|style|pre)&gt;))</string>
                    <key>beginCaptures</key>
                    <dict>
                      <key>1</key>
                      <dict>
                        <key>name</key>
                        <string>comment.punctuation.definition.markdown.python</string>
                      </dict>
                    </dict>
            <key>end</key>
            <string>(?i)(.*)((&lt;/)(script|style|pre)(&gt;))</string>
            <key>endCaptures</key>
            <dict>
              <key>1</key>
              <dict>
                <key>patterns</key>
                <array>
                  <dict>
                    <key>include</key>
                    <string>text.html.derivative</string>
                  </dict>
                </array>
              </dict>
              <key>2</key>
              <dict>
                <key>name</key>
                <string>meta.tag.structure.$4.end.html</string>
              </dict>
              <key>3</key>
              <dict>
                <key>name</key>
                <string>punctuation.definition.tag.begin.html</string>
              </dict>
              <key>4</key>
              <dict>
                <key>name</key>
                <string>entity.name.tag.html</string>
              </dict>
              <key>5</key>
              <dict>
                <key>name</key>
                <string>punctuation.definition.tag.end.html</string>
              </dict>
            </dict>
            <key>patterns</key>
            <array>
              <dict>
                <key>begin</key>
                <string>(\s*|$)</string>
                <key>patterns</key>
                <array>
                  <dict>
                    <key>include</key>
                    <string>text.html.derivative</string>
                  </dict>
                </array>
                <key>while</key>
                <string>(?i)^# (?!.*&lt;/(script|style|pre)&gt;)</string>
              </dict>
            </array>
          </dict>
          <dict>
            <key>begin</key>
            <string>(?i)(^# |\G# )\s*(?=&lt;/?[a-zA-Z]+[^\s/&amp;gt;]*(\s|$|/?&gt;))</string>
                    <key>beginCaptures</key>
                    <dict>
                      <key>1</key>
                      <dict>
                        <key>name</key>
                        <string>comment.punctuation.definition.markdown.python</string>
                      </dict>
                    </dict>
            <key>patterns</key>
            <array>
              <dict>
                <key>include</key>
                <string>text.html.derivative</string>
              </dict>
            </array>
            <key>while</key>
            <string>^# (?!\s*$)</string>
          </dict>
          <dict>
            <key>begin</key>
            <string>(^# |\G# )\s*(?=(&lt;[a-zA-Z0-9\-](/?&gt;|\s.*?&gt;)|&lt;/[a-zA-Z0-9\-]&gt;)\s*$)</string>
                    <key>beginCaptures</key>
                    <dict>
                      <key>1</key>
                      <dict>
                        <key>name</key>
                        <string>comment.punctuation.definition.markdown.python</string>
                      </dict>
                    </dict>
            <key>patterns</key>
            <array>
              <dict>
                <key>include</key>
                <string>text.html.derivative</string>
              </dict>
            </array>
            <key>while</key>
            <string>^# (?!\s*$)</string>
          </dict>
        </array>
      </dict>
      <key>link-def</key>
      <dict>
        <key>captures</key>
        <dict>
          <key>1</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.constant.markdown.python</string>
          </dict>
          <key>2</key>
          <dict>
            <key>name</key>
            <string>constant.other.reference.link.markdown.python</string>
          </dict>
          <key>3</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.constant.markdown.python</string>
          </dict>
          <key>4</key>
          <dict>
            <key>name</key>
            <string>punctuation.separator.key-value.markdown.python</string>
          </dict>
          <key>5</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.link.markdown.python</string>
          </dict>
          <key>6</key>
          <dict>
            <key>name</key>
            <string>markup.underline.link.markdown.python</string>
          </dict>
          <key>7</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.link.markdown.python</string>
          </dict>
          <key>8</key>
          <dict>
            <key>name</key>
            <string>string.other.link.description.title.markdown.python</string>
          </dict>
          <key>9</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.string.begin.markdown.python</string>
          </dict>
          <key>10</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.string.end.markdown.python</string>
          </dict>
          <key>11</key>
          <dict>
            <key>name</key>
            <string>string.other.link.description.title.markdown.python</string>
          </dict>
          <key>12</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.string.begin.markdown.python</string>
          </dict>
          <key>13</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.string.end.markdown.python</string>
          </dict>
        </dict>
        <key>match</key>
        <string>(?x)
  \s*            # Leading whitespace
  (\[)([^]]+?)(\])(:)    # Reference name
  [ \t]*          # Optional whitespace
  (&lt;?)(\S+?)(&gt;?)      # The url
  [ \t]*          # Optional whitespace
  (?:
      ((\().+?(\)))    # Match title in quotes…
    | ((").+?("))    # or in parens.
  )?            # Title is optional
  \s*            # Optional whitespace
  $
</string>
        <key>name</key>
        <string>meta.link.reference.def.markdown.python</string>
      </dict>
      <key>list_paragraph</key>
      <dict>
        <key>begin</key>
        <string>(^# |\G# )(?=\S)(?![*+-&gt;]\s|[0-9]+\.\s)</string>
                    <key>beginCaptures</key>
                    <dict>
                      <key>1</key>
                      <dict>
                        <key>name</key>
                        <string>comment.punctuation.definition.markdown.python</string>
                      </dict>
                    </dict>
        <key>name</key>
        <string>meta.paragraph.markdown.python</string>
        <key>patterns</key>
        <array>
          <dict>
            <key>include</key>
            <string>#inline</string>
          </dict>
          <dict>
            <key>include</key>
            <string>text.html.derivative</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#heading-setext</string>
          </dict>
        </array>
        <key>while</key>
        <string>(^# |\G# )(?!\s*$|#|[ ]{0,3}([-*_&gt;][ ]{2,}){3,}[ \t]*$(?:\\n# )?|[ ]{0,3}[*+-&gt;]|[ ]{0,3}[0-9]+\.)</string>
                    <key>whileCaptures</key>
                    <dict>
                      <key>1</key>
                      <dict>
                        <key>name</key>
                        <string>comment.punctuation.definition.markdown.python</string>
                      </dict>
                    </dict>
      </dict>
      <key>lists</key>
      <dict>
        <key>patterns</key>
        <array>
          <dict>
            <key>begin</key>
            <string>(^# |\G# )([ ]{0,3})([*+-])([ \t])</string>
            <key>beginCaptures</key>
            <dict>
              <key>3</key>
              <dict>
                <key>name</key>
                <string>punctuation.definition.list.begin.markdown.python</string>
              </dict>
            </dict>
            <key>comment</key>
            <string>Currently does not support un-indented second lines.</string>
            <key>name</key>
            <string>markup.list.unnumbered.markdown.python</string>
            <key>patterns</key>
            <array>
              <dict>
                <key>include</key>
                <string>#block</string>
              </dict>
              <dict>
                <key>include</key>
                <string>#list_paragraph</string>
              </dict>
            </array>
            <key>while</key>
            <string>((^# |\G# )([ ]{2,4}|\t))|(^# [ \t]*$)</string>
                    <key>whileCaptures</key>
                    <dict>
                      <key>1</key>
                      <dict>
                        <key>name</key>
                        <string>comment.punctuation.definition.markdown.python</string>
                      </dict>
                    </dict>
          </dict>
          <dict>
            <key>begin</key>
            <string>(^# |\G# )([ ]{0,3})([0-9]+\.)([ \t])</string>
            <key>beginCaptures</key>
            <dict>
              <key>3</key>
              <dict>
                <key>name</key>
                <string>punctuation.definition.list.begin.markdown.python</string>
              </dict>
            </dict>
            <key>name</key>
            <string>markup.list.numbered.markdown.python</string>
            <key>patterns</key>
            <array>
              <dict>
                <key>include</key>
                <string>#block</string>
              </dict>
              <dict>
                <key>include</key>
                <string>#list_paragraph</string>
              </dict>
            </array>
            <key>while</key>
            <string>((^# |\G# )([ ]{2,4}|\t))|(^# [ \t]*$)</string>
                    <key>whileCaptures</key>
                    <dict>
                      <key>1</key>
                      <dict>
                        <key>name</key>
                        <string>comment.punctuation.definition.markdown.python</string>
                      </dict>
                    </dict>
          </dict>
        </array>
      </dict>
      <key>paragraph</key>
      <dict>
        <key>begin</key>
        <string>(^# |\G# )[ ]{0,3}(?=\S)</string>
                    <key>beginCaptures</key>
                    <dict>
                      <key>1</key>
                      <dict>
                        <key>name</key>
                        <string>comment.punctuation.definition.markdown.python</string>
                      </dict>
                    </dict>
        <key>name</key>
        <string>meta.paragraph.markdown.python</string>
        <key>patterns</key>
        <array>
          <dict>
            <key>include</key>
            <string>#inline</string>
          </dict>
          <dict>
            <key>include</key>
            <string>text.html.derivative</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#heading-setext</string>
          </dict>
        </array>
        <key>while</key>
        <string>(^# |\G# )((?=\s*[-=]{3,}\s*$)|[ ]{4,}(?=\S))</string>
                    <key>whileCaptures</key>
                    <dict>
                      <key>1</key>
                      <dict>
                        <key>name</key>
                        <string>comment.punctuation.definition.markdown.python</string>
                      </dict>
                    </dict>
      </dict>
      <key>raw_block</key>
      <dict>
        <key>begin</key>
        <string>(^# |\G# )([ ]{4}|\t)</string>
                    <key>beginCaptures</key>
                    <dict>
                      <key>1</key>
                      <dict>
                        <key>name</key>
                        <string>comment.punctuation.definition.markdown.python</string>
                      </dict>
                    </dict>
        <key>name</key>
        <string>markup.raw.block.markdown.python</string>
        <key>while</key>
        <string>(^# |\G# )([ ]{4}|\t)</string>
                    <key>whileCaptures</key>
                    <dict>
                      <key>1</key>
                      <dict>
                        <key>name</key>
                        <string>comment.punctuation.definition.markdown.python</string>
                      </dict>
                    </dict>
      </dict>
      <key>separator</key>
      <dict>
        <key>match</key>
        <string>(^# |\G# )[ ]{0,3}([\*\-\_])([ ]{0,2}\2){2,}[ \t]*$(?:\\n# )?</string>
        <key>captures</key>
        <dict>
          <key>1</key>
          <dict>
            <key>name</key>
            <string>comment.punctuation.definition.markdown.python</string>
          </dict>
        </dict>
        <key>name</key>
        <string>meta.separator.markdown.python</string>
      </dict>


      <key>inline</key>
      <dict>
        <key>patterns</key>
        <array>
          <dict>
            <key>include</key>
            <string>#ampersand</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#bracket</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#bold</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#italic</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#raw</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#escape</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#image-inline</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#image-ref</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#link-email</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#link-inet</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#link-inline</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#link-ref</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#link-ref-literal</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#link-ref-shortcut</string>
          </dict>
        </array>
      </dict>
      <key>ampersand</key>
      <dict>
        <key>comment</key>
        <string>Markdown will convert this for us. We match it so that the HTML grammar will not mark it up as invalid.</string>
        <key>match</key>
        <string>&amp;(?!([a-zA-Z0-9]+|#[0-9]+|#x[0-9a-fA-F]+);)</string>
        <key>name</key>
        <string>meta.other.valid-ampersand.markdown.python</string>
      </dict>
      <key>bold</key>
      <dict>
        <key>begin</key>
        <string>(?x) (?&lt;open&gt;(\*\*(?=\w)|(?&lt;!\w)\*\*|(?&lt;!\w)\b__))(?=\S) (?=
  (
    &lt;[^&gt;]*+&gt;              # HTML tags
    | (?&lt;raw&gt;`+)([^`]|(?!(?&lt;!`)\k&lt;raw&gt;(?!`))`)*+\k&lt;raw&gt;
                      # Raw
    | \\[\\`*_{}\[\]()#.!+\-&gt;]?+      # Escapes
    | \[
    (
        (?&lt;square&gt;          # Named group
          [^\[\]\\]        # Match most chars
          | \\.            # Escaped chars
          | \[ \g&lt;square&gt;*+ \]    # Nested brackets
        )*+
      \]
      (
        (              # Reference Link
          [ ]?          # Optional space
          \[[^\]]*+\]        # Ref name
        )
        | (              # Inline Link
          \(            # Opening paren
            [ \t]*+        # Optional whitespace
            &lt;?(.*?)&gt;?      # URL
            [ \t]*+        # Optional whitespace
            (          # Optional Title
              (?&lt;title&gt;['"])
              (.*?)
              \k&lt;title&gt;
            )?
          \)
        )
      )
    )
    | (?!(?&lt;=\S)\k&lt;open&gt;).            # Everything besides
                      # style closer
  )++
  (?&lt;=\S)(?=__\b|\*\*)\k&lt;open&gt;                # Close
)
</string>
        <key>captures</key>
        <dict>
          <key>1</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.bold.markdown.python</string>
          </dict>
        </dict>
        <key>end</key>
        <string>(?&lt;=\S)(\1)</string>
        <key>name</key>
        <string>markup.bold.markdown.python</string>
        <key>patterns</key>
        <array>
          <dict>
            <key>applyEndPatternLast</key>
            <integer>1</integer>
            <key>begin</key>
            <string>(?=&lt;[^&gt;]*?&gt;)</string>
            <key>end</key>
            <string>(?&lt;=&gt;)</string>
            <key>patterns</key>
            <array>
              <dict>
                <key>include</key>
                <string>text.html.derivative</string>
              </dict>
            </array>
          </dict>
          <dict>
            <key>include</key>
            <string>#escape</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#ampersand</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#bracket</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#raw</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#bold</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#italic</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#image-inline</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#link-inline</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#link-inet</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#link-email</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#image-ref</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#link-ref-literal</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#link-ref</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#link-ref-shortcut</string>
          </dict>
        </array>
      </dict>
      <key>bracket</key>
      <dict>
        <key>comment</key>
        <string>Markdown will convert this for us. We match it so that the HTML grammar will not mark it up as invalid.</string>
        <key>match</key>
        <string>&lt;(?![a-zA-Z/?\$!])</string>
        <key>name</key>
        <string>meta.other.valid-bracket.markdown.python</string>
      </dict>
      <key>escape</key>
      <dict>
        <key>match</key>
        <string>\\[-`*_#+.!(){}\[\]\\&gt;]</string>
        <key>name</key>
        <string>constant.character.escape.markdown.python</string>
      </dict>
      <key>image-inline</key>
      <dict>
        <key>captures</key>
        <dict>
          <key>1</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.string.begin.markdown.python</string>
          </dict>
          <key>2</key>
          <dict>
            <key>name</key>
            <string>string.other.link.description.markdown.python</string>
          </dict>
          <key>4</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.string.end.markdown.python</string>
          </dict>
          <key>5</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.metadata.markdown.python</string>
          </dict>
          <key>6</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.link.markdown.python</string>
          </dict>
          <key>7</key>
          <dict>
            <key>name</key>
            <string>markup.underline.link.image.markdown.python</string>
          </dict>
          <key>8</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.link.markdown.python</string>
          </dict>
          <key>9</key>
          <dict>
            <key>name</key>
            <string>string.other.link.description.title.markdown.python</string>
          </dict>
          <key>10</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.string.markdown.python</string>
          </dict>
          <key>11</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.string.markdown.python</string>
          </dict>
          <key>12</key>
          <dict>
            <key>name</key>
            <string>string.other.link.description.title.markdown.python</string>
          </dict>
          <key>13</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.string.markdown.python</string>
          </dict>
          <key>14</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.string.markdown.python</string>
          </dict>
          <key>15</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.metadata.markdown.python</string>
          </dict>
        </dict>
        <key>match</key>
        <string>(?x)
  (\!\[)((?&lt;square&gt;[^\[\]\\]|\\.|\[\g&lt;square&gt;*+\])*+)(\])
                # Match the link text.
  (\()            # Opening paren for url
    (&lt;?)(\S+?)(&gt;?)      # The url
    [ \t]*          # Optional whitespace
    (?:
        ((\().+?(\)))    # Match title in parens…
      | ((").+?("))    # or in quotes.
    )?            # Title is optional
    \s*            # Optional whitespace
  (\))
</string>
        <key>name</key>
        <string>meta.image.inline.markdown.python</string>
      </dict>
      <key>image-ref</key>
      <dict>
        <key>captures</key>
        <dict>
          <key>1</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.string.begin.markdown.python</string>
          </dict>
          <key>2</key>
          <dict>
            <key>name</key>
            <string>string.other.link.description.markdown.python</string>
          </dict>
          <key>4</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.string.begin.markdown.python</string>
          </dict>
          <key>5</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.constant.markdown.python</string>
          </dict>
          <key>6</key>
          <dict>
            <key>name</key>
            <string>constant.other.reference.link.markdown.python</string>
          </dict>
          <key>7</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.constant.markdown.python</string>
          </dict>
        </dict>
        <key>match</key>
        <string>(\!\[)((?&lt;square&gt;[^\[\]\\]|\\.|\[\g&lt;square&gt;*+\])*+)(\])[ ]?(\[)(.*?)(\])</string>
        <key>name</key>
        <string>meta.image.reference.markdown.python</string>
      </dict>
      <key>italic</key>
      <dict>
        <key>begin</key>
        <string>(?x) (?&lt;open&gt;(\*(?=\w)|(?&lt;!\w)\*|(?&lt;!\w)\b_))(?=\S)                # Open
  (?=
    (
      &lt;[^&gt;]*+&gt;              # HTML tags
      | (?&lt;raw&gt;`+)([^`]|(?!(?&lt;!`)\k&lt;raw&gt;(?!`))`)*+\k&lt;raw&gt;
                        # Raw
      | \\[\\`*_{}\[\]()#.!+\-&gt;]?+      # Escapes
      | \[
      (
          (?&lt;square&gt;          # Named group
            [^\[\]\\]        # Match most chars
            | \\.            # Escaped chars
            | \[ \g&lt;square&gt;*+ \]    # Nested brackets
          )*+
        \]
        (
          (              # Reference Link
            [ ]?          # Optional space
            \[[^\]]*+\]        # Ref name
          )
          | (              # Inline Link
            \(            # Opening paren
              [ \t]*+        # Optional whtiespace
              &lt;?(.*?)&gt;?      # URL
              [ \t]*+        # Optional whtiespace
              (          # Optional Title
                (?&lt;title&gt;['"])
                (.*?)
                \k&lt;title&gt;
              )?
            \)
          )
        )
      )
      | \k&lt;open&gt;\k&lt;open&gt;                # Must be bold closer
      | (?!(?&lt;=\S)\k&lt;open&gt;).            # Everything besides
                        # style closer
    )++
    (?&lt;=\S)(?=_\b|\*)\k&lt;open&gt;                # Close
  )
</string>
        <key>captures</key>
        <dict>
          <key>1</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.italic.markdown.python</string>
          </dict>
        </dict>
        <key>end</key>
        <string>(?&lt;=\S)(\1)((?!\1)|(?=\1\1))</string>
        <key>name</key>
        <string>markup.italic.markdown.python</string>
        <key>patterns</key>
        <array>
          <dict>
            <key>applyEndPatternLast</key>
            <integer>1</integer>
            <key>begin</key>
            <string>(?=&lt;[^&gt;]*?&gt;)</string>
            <key>end</key>
            <string>(?&lt;=&gt;)</string>
            <key>patterns</key>
            <array>
              <dict>
                <key>include</key>
                <string>text.html.derivative</string>
              </dict>
            </array>
          </dict>
          <dict>
            <key>include</key>
            <string>#escape</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#ampersand</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#bracket</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#raw</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#bold</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#image-inline</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#link-inline</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#link-inet</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#link-email</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#image-ref</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#link-ref-literal</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#link-ref</string>
          </dict>
          <dict>
            <key>include</key>
            <string>#link-ref-shortcut</string>
          </dict>
        </array>
      </dict>
      <key>link-email</key>
      <dict>
        <key>captures</key>
        <dict>
          <key>1</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.link.markdown.python</string>
          </dict>
          <key>2</key>
          <dict>
            <key>name</key>
            <string>markup.underline.link.markdown.python</string>
          </dict>
          <key>4</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.link.markdown.python</string>
          </dict>
        </dict>
        <key>match</key>
        <string>(&lt;)((?:mailto:)?[-.\w]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)(&gt;)</string>
        <key>name</key>
        <string>meta.link.email.lt-gt.markdown.python</string>
      </dict>
      <key>link-inet</key>
      <dict>
        <key>captures</key>
        <dict>
          <key>1</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.link.markdown.python</string>
          </dict>
          <key>2</key>
          <dict>
            <key>name</key>
            <string>markup.underline.link.markdown.python</string>
          </dict>
          <key>3</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.link.markdown.python</string>
          </dict>
        </dict>
        <key>match</key>
        <string>(&lt;)((?:https?|ftp)://.*?)(&gt;)</string>
        <key>name</key>
        <string>meta.link.inet.markdown.python</string>
      </dict>
      <key>link-inline</key>
      <dict>
        <key>captures</key>
        <dict>
          <key>1</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.string.begin.markdown.python</string>
          </dict>
          <key>2</key>
          <dict>
            <key>name</key>
            <string>string.other.link.title.markdown.python</string>
          </dict>
          <key>4</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.string.end.markdown.python</string>
          </dict>
          <key>5</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.metadata.markdown.python</string>
          </dict>
          <key>6</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.link.markdown.python</string>
          </dict>
          <key>7</key>
          <dict>
            <key>name</key>
            <string>markup.underline.link.markdown.python</string>
          </dict>
          <key>9</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.link.markdown.python</string>
          </dict>
          <key>10</key>
          <dict>
            <key>name</key>
            <string>string.other.link.description.title.markdown.python</string>
          </dict>
          <key>11</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.string.begin.markdown.python</string>
          </dict>
          <key>12</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.string.end.markdown.python</string>
          </dict>
          <key>13</key>
          <dict>
            <key>name</key>
            <string>string.other.link.description.title.markdown.python</string>
          </dict>
          <key>14</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.string.begin.markdown.python</string>
          </dict>
          <key>15</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.string.end.markdown.python</string>
          </dict>
          <key>16</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.metadata.markdown.python</string>
          </dict>
        </dict>
        <key>match</key>
        <string>(?x)
  (\[)((?&lt;square&gt;[^\[\]\\]|\\.|\[\g&lt;square&gt;*+\])*+)(\])
                # Match the link text.
  (\()            # Opening paren for url
    (&lt;?)((?&lt;url&gt;(?&gt;[^\s()]+)|\(\g&lt;url&gt;*\))*)(&gt;?)      # The url
    [ \t]*          # Optional whitespace
    (?:
        ((\().+?(\)))    # Match title in parens…
      | ((").+?("))    # or in quotes.
    )?            # Title is optional
    \s*            # Optional whitespace
  (\))
</string>
        <key>name</key>
        <string>meta.link.inline.markdown.python</string>
      </dict>
      <key>link-ref</key>
      <dict>
        <key>captures</key>
        <dict>
          <key>1</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.string.begin.markdown.python</string>
          </dict>
          <key>2</key>
          <dict>
            <key>name</key>
            <string>string.other.link.title.markdown.python</string>
          </dict>
          <key>4</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.string.end.markdown.python</string>
          </dict>
          <key>5</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.constant.begin.markdown.python</string>
          </dict>
          <key>6</key>
          <dict>
            <key>name</key>
            <string>constant.other.reference.link.markdown.python</string>
          </dict>
          <key>7</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.constant.end.markdown.python</string>
          </dict>
        </dict>
        <key>match</key>
        <string>(\[)((?&lt;square&gt;[^\[\]\\]|\\.|\[\g&lt;square&gt;*+\])*+)(\])(\[)([^\]]*+)(\])</string>
        <key>name</key>
        <string>meta.link.reference.markdown.python</string>
      </dict>
      <key>link-ref-literal</key>
      <dict>
        <key>captures</key>
        <dict>
          <key>1</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.string.begin.markdown.python</string>
          </dict>
          <key>2</key>
          <dict>
            <key>name</key>
            <string>string.other.link.title.markdown.python</string>
          </dict>
          <key>4</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.string.end.markdown.python</string>
          </dict>
          <key>5</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.constant.begin.markdown.python</string>
          </dict>
          <key>6</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.constant.end.markdown.python</string>
          </dict>
        </dict>
        <key>match</key>
        <string>(\[)((?&lt;square&gt;[^\[\]\\]|\\.|\[\g&lt;square&gt;*+\])*+)(\])[ ]?(\[)(\])</string>
        <key>name</key>
        <string>meta.link.reference.literal.markdown.python</string>
      </dict>
      <key>link-ref-shortcut</key>
      <dict>
        <key>captures</key>
        <dict>
          <key>1</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.string.begin.markdown.python</string>
          </dict>
          <key>2</key>
          <dict>
            <key>name</key>
            <string>string.other.link.title.markdown.python</string>
          </dict>
          <key>3</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.string.end.markdown.python</string>
          </dict>
        </dict>
        <key>match</key>
        <string>(\[)(\S+?)(\])</string>
        <key>name</key>
        <string>meta.link.reference.markdown.python</string>
      </dict>
      <key>raw</key>
      <dict>
        <key>captures</key>
        <dict>
          <key>1</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.raw.markdown.python</string>
          </dict>
          <key>3</key>
          <dict>
            <key>name</key>
            <string>punctuation.definition.raw.markdown.python</string>
          </dict>
        </dict>
        <key>match</key>
        <string>(`+)([^`]|(?!(?&lt;!`)\1(?!`))`)*+(\1)</string>
        <key>name</key>
        <string>markup.inline.raw.string.markdown.python</string>
      </dict>









    </dict>
    <key>scopeName</key>
    <string>comment.markdown-cell-inject.python</string>
    <key>injectionSelector</key>
    <string>source.python</string>
    <key>uuid</key>
    <string>CEA6A09F-7810-487F-9167-FEA86CBB9D4D</string>
  </dict>
</plist>